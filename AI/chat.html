<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chat OLM</title>
  <link rel="icon" type="image/x-icon" href="https://avatars.githubusercontent.com/u/179893130?v=4">
  <link rel="apple-touch-icon" href="https://avatars.githubusercontent.com/u/179893130?v=4">

  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,900;1,400;1,900&family=Libre+Franklin:wght@400;700;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/40440288c0.js" crossorigin="anonymous"></script>

  <script>
    tailwind.config = {
      darkMode: 'media',
      theme: {
        extend: {
          fontFamily: {
            inter: ['Inter', 'sans-serif'],
            serif: ['Playfair Display', 'serif'],
            sans: ['Libre Franklin', 'sans-serif'],
          },
          colors: {
            paper: '#f9f7f2',
            ink: '#1a1a1a',
            'accent-blue': '#1e3a8a',
            'dark-paper': '#121212',
            'dark-ink': '#e5e7eb',
          }
        }
      }
    }
  </script>

  <style>
    /* Newspaper Paper Effect */
    .newspaper-texture {
      background-image: url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='1' cy='1' r='0.5' fill='%23000' fill-opacity='0.03'/%3E%3C/svg%3E");
    }
    @media (prefers-color-scheme: dark) {
      .newspaper-texture {
        background-image: url("data:image/svg+xml,%3Csvg width='4' height='4' viewBox='0 0 4 4' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='1' cy='1' r='0.5' fill='%23fff' fill-opacity='0.05'/%3E%3C/svg%3E");
      }
    }

    .chat-scroll {
      scrollbar-width: thin;
      scrollbar-color: #1a1a1a transparent;
    }

    .gazette-border {
      border: 3px solid #1e3a8a;
    }

    .btn-newspaper {
      background: #f9f7f2; 
      border: 2px solid #1a1a1a;
      transition: all 0.3s cubic-bezier(0.165, 0.84, 0.44, 1);
    }
    @media (prefers-color-scheme: dark) {
      .btn-newspaper { background: #121212; border-color: #3f3f46; color: #e5e7eb; }
    }
    .btn-newspaper:hover {
      background: #1e3a8a !important;
      border-color: #1e3a8a;
      color: #ffffff !important;
      transform: translateY(-1px);
      box-shadow: 2px 2px 0px rgba(0,0,0,0.15);
    }

    .typing-dots::after {
      content: '';
      animation: dots 1.5s infinite;
    }
    @keyframes dots {
      0% { content: ''; }
      33% { content: '.'; }
      66% { content: '..'; }
      100% { content: '...'; }
    }

    .modal-paper {
      background-color: #f9f7f2;
      border: 8px double #1a1a1a;
    }
    @media (prefers-color-scheme: dark) {
      .modal-paper { background-color: #121212; border-color: #3f3f46; }
    }

    #input-model-dropdown, #input-dropdown, #okemo-dropdown {
      transition: all 0.2s cubic-bezier(0.16, 1, 0.3, 1);
    }

    html { scroll-behavior: smooth; }
    ::selection { background: #1e3a8a; color: white; }
  </style>
</head>
<body class="bg-paper dark:bg-dark-paper text-ink dark:text-dark-ink font-sans newspaper-texture transition-colors duration-500 min-h-screen flex flex-col overflow-x-hidden">

  <!-- Ghost Elements -->
  <div class="hidden">
    <div id="menu-toggle"></div>
    <div id="okemo-dropdown"></div>
    <span id="model-display-number"></span>
  </div>

  <!-- Sticky Header -->
  <header class="fixed top-0 left-0 right-0 bg-paper/95 dark:bg-dark-paper/95 backdrop-blur-sm z-50 border-b border-ink/10 dark:border-white/10">
    <div class="w-full max-w-2xl mx-auto px-6 py-4">
      <div class="flex justify-between items-center mb-2">
        <nav>
          <a href="/AI/OkemoLLM.html" class="inline-flex items-center gap-2 text-[10px] font-black uppercase tracking-[0.2em] hover:text-accent-blue transition-colors group">
            <i class="fa-solid fa-arrow-left transition-transform group-hover:-translate-x-1"></i>
            <span>Back</span>
          </a>
        </nav>
        
        <a id="new-chat-link-header" class="text-[10px] font-black uppercase tracking-widest px-3 py-1 border border-ink/20 dark:border-white/20 hover:bg-ink hover:text-paper dark:hover:bg-white dark:hover:text-ink transition-all cursor-pointer">
          <i class="fa-solid fa-arrow-rotate-left"></i> Reset
        </a>
      </div>

      <div class="flex justify-between items-end border-b-2 border-ink dark:border-zinc-700 pb-2 text-[10px] font-black uppercase tracking-[0.3em] relative">
        <div class="flex items-center gap-2 relative">
          <span id="okemo-title" class="italic">OLM</span>
        </div>
        <div id="date-stamp" class="italic text-right">JANUARY 6, 2026</div>
      </div>
    </div>
  </header>

  <!-- Main Content Area with Header/Footer Clearance - Increased pb-64 for larger margin -->
  <main class="flex-1 flex flex-col w-full max-w-2xl mx-auto px-6 pt-32 pb-64 relative">
    <div id="empty-chat-prompt" class="absolute top-[45%] left-1/2 -translate-x-1/2 -translate-y-1/2 text-center w-full px-10 pointer-events-none transition-opacity duration-500">
      <div class="inline-block border-4 border-double border-ink/10 dark:border-white/10 p-8 md:p-12">
        <h2 class="font-serif text-4xl md:text-5xl font-black uppercase tracking-tighter leading-none">
          How can I help you <br><span class="italic text-accent-blue">today?</span>
        </h2>
      </div>
    </div>

    <div id="okemo-chat" class="chat-scroll flex-1 overflow-y-auto space-y-8">
      <!-- Messages go here -->
    </div>

    <!-- Scroll button - Adjusted bottom-56 to match larger margin -->
    <button id="scroll-bottom-btn" class="fixed bottom-56 left-1/2 -translate-x-1/2 btn-newspaper w-10 h-10 rounded-full flex items-center justify-center opacity-0 pointer-events-none transition-all duration-300 z-50 shadow-lg">
      <i class="fa-solid fa-arrow-down"></i>
    </button>
  </main>

  <!-- Fixed Bottom Input Bar - Made Smaller -->
  <div class="fixed bottom-0 left-0 right-0 bg-paper/95 dark:bg-dark-paper/95 backdrop-blur-sm border-t-[8px] border-double border-ink dark:border-zinc-800 pt-3 pb-4 px-4 z-40">
    <div class="max-w-lg mx-auto relative group">
      <div id="okemo-status" class="absolute -top-5 left-0 text-[9px] font-black uppercase tracking-widest opacity-40 italic h-4"></div>
      
      <div id="file-preview-container" class="mb-2 hidden"></div>

      <div class="gazette-border bg-paper dark:bg-zinc-900 flex flex-col p-2 transition-all shadow-sm">
        <textarea id="okemo-input" placeholder="ASK ANYTHING..." rows="1" class="w-full py-1 px-1 text-sm font-bold tracking-widest outline-none bg-transparent text-ink dark:text-white placeholder:text-ink/20 dark:placeholder:text-white/20 resize-none max-h-40 overflow-hidden leading-relaxed"></textarea>
        
        <div class="flex justify-between items-center mt-2 pt-2 border-t border-ink/10 dark:border-white/10">
          <div class="relative">
             <button id="plus-menu-toggle" class="w-8 h-8 flex items-center justify-center hover:text-accent-blue transition-colors flex-shrink-0">
                <i class="fa-solid fa-screwdriver-wrench text-xs"></i>
             </button>
             <div id="input-dropdown" class="absolute left-0 bottom-full mb-3 w-40 bg-paper dark:bg-dark-paper border-2 border-ink dark:border-zinc-700 shadow-xl p-1 hidden opacity-0 scale-y-0 origin-bottom-left">
               <button id="web-search-option" class="w-full text-left px-3 py-2 text-[10px] font-black uppercase tracking-wider hover:bg-ink hover:text-paper dark:hover:bg-white dark:hover:text-ink transition-colors">Web Search</button>
             </div>
          </div>

          <div class="flex items-center gap-2 relative">
            <div class="relative">
              <button id="model-switch-btn" class="flex items-center gap-2 px-2 py-1 btn-newspaper text-[8px] font-black uppercase tracking-widest">
                <span id="active-model-name">OLM 2</span>
                <i class="fa-solid fa-caret-down text-[7px]"></i>
              </button>
              
              <div id="input-model-dropdown" class="absolute right-0 bottom-full mb-3 w-40 bg-paper dark:bg-dark-paper border-2 border-ink dark:border-zinc-700 shadow-xl p-1 hidden opacity-0 scale-y-0 origin-bottom-right">
                <button id="model-select-pro" data-model-id="ar12c/okemollm" data-model-name="OLM 2" class="model-opt w-full text-left px-3 py-2 text-[10px] font-black uppercase tracking-wider hover:bg-ink hover:text-paper dark:hover:bg-white dark:hover:text-ink transition-colors">OLM 2</button>
                <button id="model-select-base" data-model-id="ar12c/okemo2" data-model-name="OLM 1" class="model-opt w-full text-left px-3 py-2 text-[10px] font-black uppercase tracking-wider hover:bg-ink hover:text-paper dark:hover:bg-white dark:hover:text-ink transition-colors">OLM 1</button>
              </div>
            </div>

            <button id="okemo-send" class="btn-newspaper w-8 h-8 flex items-center justify-center flex-shrink-0">
              <i class="fa-solid fa-paper-plane text-[10px]"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="flex justify-center mt-2">
        <p class="text-[7px] font-black uppercase tracking-widest opacity-30">
          OLM CHAT 0.2.1 | DATA MAY BE INACCURATE
        </p>
      </div>
    </div>
  </div>

  <script type="module" src="chat.js"></script>

  <script>
    window.addEventListener('load', () => {
      const modelBtn = document.getElementById('model-switch-btn');
      const modelDropdown = document.getElementById('input-model-dropdown');
      const activeName = document.getElementById('active-model-name');
      const chatContainer = document.getElementById('okemo-chat');
      const scrollBtn = document.getElementById('scroll-bottom-btn');

      if (modelBtn && modelDropdown) {
        modelBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          const isHidden = modelDropdown.classList.contains('hidden');
          if (isHidden) {
            modelDropdown.classList.remove('hidden');
            setTimeout(() => {
              modelDropdown.classList.remove('opacity-0', 'scale-y-0');
            }, 10);
          } else {
            closeModelDropdown();
          }
        });
        document.addEventListener('click', () => closeModelDropdown());
      }

      function closeModelDropdown() {
        if (!modelDropdown) return;
        modelDropdown.classList.add('opacity-0', 'scale-y-0');
        setTimeout(() => modelDropdown.classList.add('hidden'), 200);
      }

      document.querySelectorAll('.model-opt').forEach(opt => {
        opt.addEventListener('click', (e) => {
          if (activeName) activeName.textContent = opt.dataset.modelName;
          closeModelDropdown();
        });
      });

      let isAutoScrolling = true;
      const scrollToBottom = () => {
        if (!chatContainer) return;
        chatContainer.scrollTop = chatContainer.scrollHeight;
      };

      const handleScroll = () => {
        const { scrollTop, scrollHeight, clientHeight } = chatContainer;
        const isNearBottom = scrollHeight - scrollTop - clientHeight < 100;
        isAutoScrolling = isNearBottom;

        if (!isNearBottom && scrollHeight > clientHeight) {
          scrollBtn.classList.replace('opacity-0', 'opacity-100');
          scrollBtn.classList.remove('pointer-events-none');
        } else {
          scrollBtn.classList.replace('opacity-100', 'opacity-0');
          scrollBtn.classList.add('pointer-events-none');
        }
      };

      const observer = new MutationObserver(() => {
        if (isAutoScrolling) {
          scrollToBottom();
          setTimeout(scrollToBottom, 50);
        }
      });

      if (chatContainer) {
        chatContainer.addEventListener('scroll', handleScroll);
        observer.observe(chatContainer, { childList: true, subtree: true, characterData: true });
        scrollBtn.addEventListener('click', () => {
          isAutoScrolling = true;
          chatContainer.scrollTo({ top: chatContainer.scrollHeight, behavior: 'smooth' });
        });
        handleScroll();
        scrollToBottom();
      }
    });
  </script>
</body>
</html>
